<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>patient_entity_ – HEMS Simulation Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5d2e30ad26079c1dae90a1fd11eba2b9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_web_application_interface__streamlit__.html">Components</a></li><li class="breadcrumb-item"><a href="./03_patient_entity_.html">Chapter 3: Patient Entity</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">HEMS Simulation Documentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial: DAA_DES</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_web_application_interface__streamlit__.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Web Application Interface (Streamlit)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_simulation_engine__patient_journey__.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Simulation Engine (Patient Journey)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_patient_entity_.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chapter 3: Patient Entity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_hems_resource_entity_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: HEMS Resource Entity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_resource_management__availability___allocation__.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Resource Management (Availability &amp; Allocation)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_stochastic_modeling__distributions__.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6: Stochastic Modeling (Distributions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_simulation_runner___parallelization_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 7: Simulation Runner &amp; Parallelization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_results_processing___visualization_.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 8: Results Processing &amp; Visualization</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chapter-3-patient-entity" id="toc-chapter-3-patient-entity" class="nav-link active" data-scroll-target="#chapter-3-patient-entity">Chapter 3: Patient Entity</a>
  <ul class="collapse">
  <li><a href="#whats-the-point-of-a-patient-entity" id="toc-whats-the-point-of-a-patient-entity" class="nav-link" data-scroll-target="#whats-the-point-of-a-patient-entity">What’s the Point of a Patient Entity?</a></li>
  <li><a href="#meet-the-patient-entity-a-digital-case-file" id="toc-meet-the-patient-entity-a-digital-case-file" class="nav-link" data-scroll-target="#meet-the-patient-entity-a-digital-case-file">Meet the Patient Entity: A Digital Case File</a></li>
  <li><a href="#what-information-does-a-patient-entity-hold-its-attributes" id="toc-what-information-does-a-patient-entity-hold-its-attributes" class="nav-link" data-scroll-target="#what-information-does-a-patient-entity-hold-its-attributes">What Information Does a Patient Entity Hold? (Its Attributes)</a></li>
  <li><a href="#how-the-simulation-uses-the-patient-entity" id="toc-how-the-simulation-uses-the-patient-entity" class="nav-link" data-scroll-target="#how-the-simulation-uses-the-patient-entity">How the Simulation Uses the Patient Entity</a></li>
  <li><a href="#under-the-hood-the-patient-class" id="toc-under-the-hood-the-patient-class" class="nav-link" data-scroll-target="#under-the-hood-the-patient-class">Under the Hood: The <code>Patient</code> Class</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_web_application_interface__streamlit__.html">Components</a></li><li class="breadcrumb-item"><a href="./03_patient_entity_.html">Chapter 3: Patient Entity</a></li></ol></nav></header>




<section id="chapter-3-patient-entity" class="level1">
<h1>Chapter 3: Patient Entity</h1>
<p>In <a href="./02_simulation_engine__patient_journey__.html">Chapter 2: Simulation Engine (Patient Journey)</a>, we learned about the “director” of our simulation – the engine that manages the flow of events and time. Now, let’s meet the main “actor” in our simulation play: the <strong>Patient Entity</strong>.</p>
<section id="whats-the-point-of-a-patient-entity" class="level2">
<h2 class="anchored" data-anchor-id="whats-the-point-of-a-patient-entity">What’s the Point of a Patient Entity?</h2>
<p>Imagine our simulation is like a board game simulating the Devon Air Ambulance service. Each time an emergency call comes in, we need a game piece to represent that specific incident. This piece needs to move around the board (representing the stages of care) and collect properties (like how serious the incident is, the patient’s age, and what happened to them).</p>
<p>Without a way to track each individual case, we couldn’t simulate the service realistically. We wouldn’t know how many people needed help, what kind of help they needed, or whether the service was able to respond effectively to <em>each specific situation</em>.</p>
<p>The <strong>Patient Entity</strong> solves this by acting as that unique game piece. It’s a digital representation of a single emergency incident requiring potential HEMS (Helicopter Emergency Medical Service) attention.</p>
</section>
<section id="meet-the-patient-entity-a-digital-case-file" class="level2">
<h2 class="anchored" data-anchor-id="meet-the-patient-entity-a-digital-case-file">Meet the Patient Entity: A Digital Case File</h2>
<p>Think of the Patient Entity as a digital file folder or a character sheet for each specific emergency case in the simulation. It doesn’t <em>do</em> things on its own, but it <em>holds</em> all the important information about one particular incident and the person involved.</p>
<p>The <a href="./02_simulation_engine__patient_journey__.html">Simulation Engine (Patient Journey)</a> creates a new Patient Entity whenever a simulated emergency call occurs. It then fills in and updates the information in this “folder” as the simulated incident progresses.</p>
</section>
<section id="what-information-does-a-patient-entity-hold-its-attributes" class="level2">
<h2 class="anchored" data-anchor-id="what-information-does-a-patient-entity-hold-its-attributes">What Information Does a Patient Entity Hold? (Its Attributes)</h2>
<p>Our Patient Entity “folder” contains several key pieces of information, just like our game piece collects properties:</p>
<ol type="1">
<li><strong>Unique ID (<code>id</code>):</strong> Just like each game piece might have a number, each Patient Entity gets a unique identification number (e.g., Patient 1, Patient 2, … Patient 5432). This helps us track each case separately.</li>
<li><strong>Arrival Time (<code>timestamp</code> when event_type is ‘arrival’):</strong> When did the call for this patient come into the simulation? This is recorded as the simulation time (e.g., 125.5 minutes into the simulation).</li>
<li><strong>Medical Need:</strong>
<ul>
<li><strong>AMPDS Code (<code>ampds_card</code>):</strong> A code representing the type of emergency reported by the caller (e.g., “Chest Pain,” “Traffic Accident”). The simulation assigns this based on probabilities (<a href="./06_stochastic_modeling__distributions__.html">Stochastic Modeling (Distributions)</a>).</li>
<li><strong>Care Category (<code>hems_cc_or_ec</code>):</strong> Based on the AMPDS code and other factors, the simulation decides if the patient likely needs Critical Care (‘CC’), Emergency Care (‘EC’), or Regular (‘REG’) care from the HEMS team.</li>
</ul></li>
<li><strong>Demographics:</strong>
<ul>
<li><strong>Age (<code>age</code>):</strong> The simulated age of the patient.</li>
<li><strong>Sex (<code>sex</code>):</strong> The simulated sex of the patient (‘male’ or ‘female’). These are assigned based on patterns observed in real data (<a href="./06_stochastic_modeling__distributions__.html">Stochastic Modeling (Distributions)</a>).</li>
</ul></li>
<li><strong>Journey Tracking &amp; Outcomes:</strong>
<ul>
<li><strong>Journey Stages:</strong> The “folder” keeps track of when key events happened for this patient (e.g., when HEMS was assigned, when they arrived at the scene, when they left the scene).</li>
<li><strong>HEMS Result (<code>hems_result</code>):</strong> What happened with the HEMS response? (e.g., “Patient Conveyed,” “Stand Down En Route,” “Landed but no patient contact”).</li>
<li><strong>Final Outcome (<code>pt_outcome</code>):</strong> What was the ultimate outcome for this specific simulated case? (e.g., “Airlifted,” “Conveyed by land with DAA,” “Deceased”).</li>
<li><strong>Assigned Resource (<code>callsign</code>, <code>registration</code>):</strong> If a HEMS resource was assigned, which one was it? (e.g., Helicopter G-DAAN). This links the patient to a specific <a href="./04_hems_resource_entity_.html">HEMS Resource Entity</a>.</li>
</ul></li>
</ol>
</section>
<section id="how-the-simulation-uses-the-patient-entity" class="level2">
<h2 class="anchored" data-anchor-id="how-the-simulation-uses-the-patient-entity">How the Simulation Uses the Patient Entity</h2>
<p>The <a href="./02_simulation_engine__patient_journey__.html">Simulation Engine (Patient Journey)</a> is the one that interacts with the Patient Entity.</p>
<ol type="1">
<li><p><strong>Creation:</strong> When the engine decides a new call occurs, it creates a brand new, empty Patient Entity object.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In des_hems.py (simplified 'generate_patient' function)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ... inside the function when a new call happens ...</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.patient_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new Patient object, giving it a unique ID</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>pt <span class="op">=</span> Patient(<span class="va">self</span>.patient_counter)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Now 'pt' is our new, mostly empty, patient folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code snippet, found within the <code>generate_patient</code> function in <code>des_hems.py</code>, shows the creation of a new <code>Patient</code> instance (<code>pt</code>) using the <code>Patient</code> class definition (which we’ll look at next).</p></li>
<li><p><strong>Filling Details:</strong> The engine then uses functions (often relying on <a href="./06_stochastic_modeling__distributions__.html">Stochastic Modeling (Distributions)</a>) to fill in the initial details.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In des_hems.py (simplified 'generate_patient' function)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign details to the 'pt' object</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>pt.hour <span class="op">=</span> hod <span class="co"># Hour the call arrived</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>pt.ampds_card <span class="op">=</span> <span class="va">self</span>.utils.ampds_code_selection(pt.hour) <span class="co"># Assign medical code</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>pt.age <span class="op">=</span> <span class="va">self</span>.utils.age_sampling(pt.ampds_card, <span class="dv">115</span>) <span class="co"># Assign age</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>pt.sex <span class="op">=</span> <span class="va">self</span>.utils.sex_selection(pt.ampds_card) <span class="co"># Assign sex</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>pt.hems_cc_or_ec <span class="op">=</span> <span class="va">self</span>.utils.care_category_selection(pt.ampds_card) <span class="co"># Assign care need</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ... other initial details ...</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Record the arrival event in the results log</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.add_patient_result_row(pt, <span class="st">"arrival"</span>, <span class="st">"arrival_departure"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, the engine calls utility functions (<code>self.utils...</code>) to determine things like the medical code (<code>ampds_card</code>) and demographics (<code>age</code>, <code>sex</code>) and stores them directly into the <code>pt</code> object’s attributes.</p></li>
<li><p><strong>Updating During Journey:</strong> As the engine guides the patient through their simulated journey (mobilisation, travel, scene time, etc.), it updates the Patient Entity and records events.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In des_hems.py (simplified 'patient_journey' function)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ... after simulating mobilisation time ...</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>mobilisation_time <span class="op">=</span> <span class="va">self</span>.utils.activity_time(patient.hems_vehicle_type, <span class="st">'time_mobile'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">yield</span> <span class="va">self</span>.env.timeout(mobilisation_time) <span class="co"># Advance simulation clock</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Record that the HEMS resource is now mobile for this patient</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.add_patient_result_row(patient, <span class="st">"HEMS mobile"</span>, <span class="st">"queue"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ... later, after simulating travel time ...</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>tts_time <span class="op">=</span> <span class="va">self</span>.utils.activity_time(patient.hems_vehicle_type, <span class="st">'time_to_scene'</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="cf">yield</span> <span class="va">self</span>.env.timeout(tts_time) <span class="co"># Advance simulation clock</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Record that HEMS is on scene for this patient</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.add_patient_result_row(patient, <span class="st">"HEMS on scene"</span>, <span class="st">"queue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the <code>patient_journey</code> function, after simulating a time delay (<code>yield self.env.timeout(...)</code>), the engine calls <code>self.add_patient_result_row(...)</code>. This function takes the <code>patient</code> object (our Patient Entity) and the event details (“HEMS mobile”, “HEMS on scene”) and logs them. This log file becomes the raw data for <a href="./08_results_processing___visualization_.html">Results Processing &amp; Visualization</a>.</p></li>
</ol>
</section>
<section id="under-the-hood-the-patient-class" class="level2">
<h2 class="anchored" data-anchor-id="under-the-hood-the-patient-class">Under the Hood: The <code>Patient</code> Class</h2>
<p>The blueprint for creating these Patient Entity “folders” is defined in a Python file called <code>class_patient.py</code>. This file contains a <code>class</code> named <code>Patient</code>. A class is like a template for creating objects.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In class_patient.py (Heavily Simplified Structure)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Patient:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The __init__ method is called when a new Patient object is created</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, p_id: <span class="bu">int</span>):</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Core Identifiers ---</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> p_id          <span class="co"># Unique ID for this patient instance</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.time_in_sim <span class="op">=</span> <span class="dv">0</span>    <span class="co"># How long this patient has been in the sim (updated later)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.current_dt <span class="op">=</span> <span class="va">None</span>  <span class="co"># The datetime the patient entered the sim (set later)</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Incident &amp; Medical Details (Filled in by Simulation Engine) ---</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ampds_card <span class="op">=</span> <span class="st">""</span>    <span class="co"># e.g., "17A1" (Falls)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hems_cc_or_ec <span class="op">=</span> <span class="st">"REG"</span> <span class="co"># Care Category: 'CC', 'EC', or 'REG'</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ... other incident details like location (postcode, lat/long) ...</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Demographics (Filled in by Simulation Engine) ---</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.age <span class="op">=</span> <span class="dv">0</span>            <span class="co"># e.g., 65</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sex <span class="op">=</span> <span class="st">"female"</span>     <span class="co"># e.g., "male" or "female"</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Journey &amp; Outcome Tracking (Filled in by Simulation Engine) ---</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hems_case <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>     <span class="co"># Is this potentially a HEMS case? (1=yes, 0=no)</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hems_result <span class="op">=</span> <span class="st">""</span>   <span class="co"># e.g., "Patient Conveyed", "Stand Down En Route"</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pt_outcome <span class="op">=</span> <span class="st">""</span>    <span class="co"># e.g., "Airlifted", "Deceased"</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.callsign <span class="op">=</span> <span class="st">""</span>      <span class="co"># Callsign of assigned HEMS resource (e.g., "H70")</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hems_vehicle_type <span class="op">=</span> <span class="st">""</span> <span class="co"># e.g., "Helicopter", "Car"</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ... other tracking variables ...</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (The Patient class doesn't usually have many methods,</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  it mostly just holds data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When the line <code>pt = Patient(self.patient_counter)</code> runs in <code>des_hems.py</code>, Python uses this <code>Patient</code> class blueprint to create a new object in memory. This object starts with the default values shown above (like <code>ampds_card = ""</code>, <code>age = 0</code>). The <a href="./02_simulation_engine__patient_journey__.html">Simulation Engine (Patient Journey)</a> then accesses and modifies these attributes (like <code>pt.age = calculated_age</code>) as the simulation progresses.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The Patient Entity is the fundamental unit representing an individual emergency case within the DAA_DES simulation. It acts like a digital file folder or a game piece, holding crucial information like the patient’s ID, medical needs, demographics, and the details of their journey through the HEMS system.</p>
<p>While the <a href="./02_simulation_engine__patient_journey__.html">Simulation Engine (Patient Journey)</a> <em>directs</em> the action, the Patient Entity <em>stores</em> the state and characteristics of each case. Understanding this data container is key to seeing how the simulation tracks individual experiences and generates meaningful results.</p>
<p>Now that we’ve met the patient, let’s look at the other crucial actors in our simulation: the emergency resources themselves.</p>
<p><strong>Next:</strong> <a href="./04_hems_resource_entity_.html">Chapter 4: HEMS Resource Entity</a></p>
<hr>
<p>Generated by <a href="https://github.com/The-Pocket/Tutorial-Codebase-Knowledge">AI Codebase Knowledge Builder</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>